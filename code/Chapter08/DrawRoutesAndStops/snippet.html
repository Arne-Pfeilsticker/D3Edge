 <pre><code style="display: block; padding: 0.5em; background-color: #f4f4f4; font-size: 0.75em; color: black;"><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">001:</span><span class="comment" style="color: #777;">//Define&nbsp;the&nbsp;namespace&nbsp;for&nbsp;our&nbsp;API.</span><br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">002:</span><span class="keyword" style="font-weight: bold; color: navy;">var</span>&nbsp;d3Edge&nbsp;=&nbsp;{};<br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">003:</span><br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">004:</span><span class="comment" style="color: #777;">//Define&nbsp;our&nbsp;data&nbsp;manager&nbsp;module.</span><br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">005:</span>d3Edge.dataManager&nbsp;=&nbsp;<span class="function"><span class="keyword" style="font-weight: bold; color: navy;">function</span>&nbsp;<span class="func-title">module</span><span class="params">()</span>&nbsp;{</span><br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">006:</span>&nbsp;&nbsp;<span class="keyword" style="font-weight: bold; color: navy;">var</span>&nbsp;exports&nbsp;=&nbsp;{},<br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">007:</span>&nbsp;&nbsp;&nbsp;&nbsp;dispatch&nbsp;=&nbsp;d3.dispatch(<span class="string" style="color: #050;">'geoReady'</span>,&nbsp;<span class="string" style="color: #050;">'dataReady'</span>,&nbsp;<span class="string" style="color: #050;">'dataLoading'</span>),<br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">008:</span>&nbsp;&nbsp;&nbsp;&nbsp;data;<br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">009:</span><br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">010:</span>&nbsp;&nbsp;<span class="comment" style="color: #777;">//Create&nbsp;a&nbsp;method&nbsp;to&nbsp;load&nbsp;the&nbsp;csv&nbsp;file,&nbsp;and&nbsp;apply&nbsp;cleaning&nbsp;function&nbsp;asynchronously.</span><br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">011:</span>&nbsp;&nbsp;exports.loadCsvData&nbsp;=&nbsp;<span class="keyword" style="font-weight: bold; color: navy;">function</span>(_file,&nbsp;_cleaningFunc)&nbsp;{<br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">012:</span><br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">013:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" style="color: #777;">//Create&nbsp;the&nbsp;csv&nbsp;request&nbsp;using&nbsp;d3.csv.</span><br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">014:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" style="font-weight: bold; color: navy;">var</span>&nbsp;loadCsv&nbsp;=&nbsp;d3.csv(_file);<br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">015:</span><br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">016:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" style="color: #777;">//On&nbsp;the&nbsp;progress&nbsp;event,&nbsp;dispatch&nbsp;the&nbsp;custom&nbsp;dataLoading&nbsp;event.</span><br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">017:</span>&nbsp;&nbsp;&nbsp;&nbsp;loadCsv.on(<span class="string" style="color: #050;">'progress'</span>,&nbsp;<span class="keyword" style="font-weight: bold; color: navy;">function</span>()&nbsp;{&nbsp;dispatch.dataLoading(d3.event.loaded);});<br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">018:</span><br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">019:</span>&nbsp;&nbsp;&nbsp;&nbsp;loadCsv.get(<span class="function"><span class="keyword" style="font-weight: bold; color: navy;">function</span>&nbsp;<span class="params">(_err,&nbsp;_response)</span>&nbsp;{</span><br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">020:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" style="color: #777;">//Apply&nbsp;the&nbsp;cleaning&nbsp;function&nbsp;supplied&nbsp;in&nbsp;the&nbsp;_cleaningFunc&nbsp;parameter.</span><br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">021:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;_response.forEach(<span class="function"><span class="keyword" style="font-weight: bold; color: navy;">function</span>&nbsp;<span class="params">(d)</span>&nbsp;{</span><br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">022:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;_cleaningFunc(d);<br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">023:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;});<br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">024:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" style="color: #777;">//Assign&nbsp;the&nbsp;cleaned&nbsp;response&nbsp;to&nbsp;our&nbsp;data&nbsp;variable.</span><br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">025:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;data&nbsp;=&nbsp;_response;<br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">026:</span><br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">027:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" style="color: #777;">//Dispatch&nbsp;our&nbsp;custom&nbsp;dataReady&nbsp;event&nbsp;passing&nbsp;in&nbsp;the&nbsp;cleaned&nbsp;data.</span><br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">028:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;dispatch.dataReady(_response);<br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">029:</span>&nbsp;&nbsp;&nbsp;&nbsp;});<br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">030:</span>&nbsp;&nbsp;};<br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">031:</span>&nbsp;&nbsp;<span class="comment" style="color: #777;">//Create&nbsp;a&nbsp;method&nbsp;to&nbsp;access&nbsp;the&nbsp;cleaned&nbsp;data.</span><br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">032:</span>&nbsp;&nbsp;exports.getCleanedData&nbsp;=&nbsp;<span class="function"><span class="keyword" style="font-weight: bold; color: navy;">function</span>&nbsp;<span class="params">()</span>&nbsp;{</span><br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">033:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" style="font-weight: bold; color: navy;">return</span>&nbsp;data;<br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">034:</span>&nbsp;&nbsp;};<br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">035:</span><br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">036:</span>&nbsp;&nbsp;<span class="comment" style="color: #777;">//Create&nbsp;a&nbsp;method&nbsp;to&nbsp;load&nbsp;the&nbsp;geojson&nbsp;file,&nbsp;and&nbsp;execute&nbsp;a&nbsp;custom&nbsp;callback&nbsp;on&nbsp;response.</span><br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">037:</span>&nbsp;&nbsp;exports.loadGeoJson&nbsp;=&nbsp;<span class="keyword" style="font-weight: bold; color: navy;">function</span>(_file,&nbsp;_callback)&nbsp;{<br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">038:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" style="color: #777;">//Load&nbsp;json&nbsp;file&nbsp;using&nbsp;d3.json.</span><br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">039:</span>&nbsp;&nbsp;&nbsp;&nbsp;d3.json(_file,&nbsp;<span class="function"><span class="keyword" style="font-weight: bold; color: navy;">function</span>&nbsp;<span class="params">(_err,&nbsp;_data)</span>&nbsp;{</span><br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">040:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" style="color: #777;">//Execute&nbsp;the&nbsp;callback,&nbsp;assign&nbsp;the&nbsp;data&nbsp;to&nbsp;the&nbsp;context.</span><br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">041:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;_callback(_data);<br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">042:</span>&nbsp;&nbsp;&nbsp;&nbsp;});<br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">043:</span>&nbsp;&nbsp;};<br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">044:</span><br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">045:</span>&nbsp;&nbsp;d3.rebind(exports,&nbsp;dispatch,&nbsp;<span class="string" style="color: #050;">'on'</span>);<br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">046:</span><br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">047:</span>&nbsp;&nbsp;<span class="keyword" style="font-weight: bold; color: navy;">return</span>&nbsp;exports;<br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">048:</span>};<br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">049:</span><br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">050:</span><span class="comment" style="color: #777;">//Define&nbsp;our&nbsp;map&nbsp;module.</span><br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">051:</span>d3Edge.map&nbsp;=&nbsp;<span class="function"><span class="keyword" style="font-weight: bold; color: navy;">function</span>&nbsp;<span class="func-title">module</span><span class="params">()</span>&nbsp;{</span><br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">052:</span>&nbsp;&nbsp;<span class="comment" style="color: #777;">//Create&nbsp;our&nbsp;custom&nbsp;events,&nbsp;and&nbsp;variables.</span><br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">053:</span>&nbsp;&nbsp;<span class="keyword" style="font-weight: bold; color: navy;">var</span>&nbsp;dispatch&nbsp;=&nbsp;d3.dispatch(<span class="string" style="color: #050;">'hover'</span>,&nbsp;<span class="string" style="color: #050;">'stopsEnd'</span>,&nbsp;<span class="string" style="color: #050;">'routesEnd'</span>,&nbsp;<span class="string" style="color: #050;">'brushing'</span>),<br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">054:</span>&nbsp;&nbsp;&nbsp;&nbsp;projection,&nbsp;path,&nbsp;t,&nbsp;s,&nbsp;svg,&nbsp;center,&nbsp;scale,&nbsp;size,&nbsp;brush;<br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">055:</span><br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">056:</span>&nbsp;&nbsp;<span class="comment" style="color: #777;">//Create&nbsp;and&nbsp;exports&nbsp;function&nbsp;that&nbsp;can&nbsp;be&nbsp;invoked&nbsp;on&nbsp;a&nbsp;selection.</span><br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">057:</span>&nbsp;&nbsp;<span class="function"><span class="keyword" style="font-weight: bold; color: navy;">function</span>&nbsp;<span class="func-title">exports</span><span class="params">(_selection)</span>&nbsp;{</span><br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">058:</span><br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">059:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" style="color: #777;">//Set&nbsp;svg&nbsp;equal&nbsp;to&nbsp;the&nbsp;selection&nbsp;that&nbsp;invokes&nbsp;this&nbsp;module.</span><br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">060:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;svg&nbsp;=&nbsp;svg&nbsp;||&nbsp;_selection;<br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">061:</span><br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">062:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" style="color: #777;">//Bind&nbsp;an&nbsp;empty&nbsp;datum&nbsp;to&nbsp;the&nbsp;selection.&nbsp;Usefull&nbsp;later&nbsp;for&nbsp;zooming.</span><br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">063:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;svg.datum([]);<br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">064:</span><br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">065:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" style="color: #777;">//Set&nbsp;the&nbsp;projection&nbsp;up&nbsp;using&nbsp;our&nbsp;scale,&nbsp;center,&nbsp;and&nbsp;size&nbsp;parameters.</span><br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">066:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;projection&nbsp;=&nbsp;projection&nbsp;||&nbsp;d3.geo.mercator()<br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">067:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.scale(scale)<br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">068:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.center(center)<br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">069:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.translate([size[<span class="number" style="color: #800;">0</span>]/<span class="number" style="color: #800;">2</span>,&nbsp;size[<span class="number" style="color: #800;">1</span>]/<span class="number" style="color: #800;">2</span>]);<br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">070:</span><br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">071:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" style="color: #777;">//Set&nbsp;the&nbsp;path&nbsp;up&nbsp;using&nbsp;our&nbsp;projection&nbsp;definied&nbsp;above.</span><br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">072:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;path&nbsp;=&nbsp;path&nbsp;||&nbsp;d3.geo.path()<br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">073:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.projection(projection);<br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">074:</span><br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">075:</span>&nbsp;&nbsp;}<br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">076:</span><br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">077:</span>&nbsp;&nbsp;<span class="comment" style="color: #777;">//Create&nbsp;a&nbsp;center&nbsp;method&nbsp;to&nbsp;serve&nbsp;as&nbsp;both&nbsp;a&nbsp;getter,&nbsp;and&nbsp;a&nbsp;setter.</span><br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">078:</span>&nbsp;&nbsp;exports.center&nbsp;=&nbsp;<span class="keyword" style="font-weight: bold; color: navy;">function</span>(_coords)&nbsp;{<br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">079:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" style="font-weight: bold; color: navy;">if</span>&nbsp;(!arguments.length)&nbsp;<span class="keyword" style="font-weight: bold; color: navy;">return</span>&nbsp;center;<br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">080:</span>&nbsp;&nbsp;&nbsp;&nbsp;center&nbsp;=&nbsp;_coords;<br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">081:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" style="font-weight: bold; color: navy;">return</span>&nbsp;<span class="keyword" style="font-weight: bold; color: navy;">this</span>;<br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">082:</span>&nbsp;&nbsp;};<br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">083:</span><br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">084:</span>&nbsp;&nbsp;<span class="comment" style="color: #777;">//Create&nbsp;a&nbsp;scale&nbsp;method&nbsp;to&nbsp;serve&nbsp;as&nbsp;both&nbsp;a&nbsp;getter,&nbsp;and&nbsp;a&nbsp;setter.</span><br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">085:</span>&nbsp;&nbsp;exports.scale&nbsp;=&nbsp;<span class="keyword" style="font-weight: bold; color: navy;">function</span>(_scale)&nbsp;{<br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">086:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" style="font-weight: bold; color: navy;">if</span>&nbsp;(!arguments.length)&nbsp;<span class="keyword" style="font-weight: bold; color: navy;">return</span>&nbsp;scale;<br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">087:</span>&nbsp;&nbsp;&nbsp;&nbsp;scale&nbsp;=&nbsp;_scale;<br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">088:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" style="font-weight: bold; color: navy;">return</span>&nbsp;<span class="keyword" style="font-weight: bold; color: navy;">this</span>;<br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">089:</span>&nbsp;&nbsp;};<br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">090:</span><br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">091:</span>&nbsp;&nbsp;<span class="comment" style="color: #777;">//Create&nbsp;a&nbsp;size&nbsp;method&nbsp;to&nbsp;serve&nbsp;as&nbsp;both&nbsp;a&nbsp;getter&nbsp;and&nbsp;setter.</span><br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">092:</span>&nbsp;&nbsp;exports.size&nbsp;=&nbsp;<span class="keyword" style="font-weight: bold; color: navy;">function</span>(_size)&nbsp;{<br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">093:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" style="font-weight: bold; color: navy;">if</span>&nbsp;(!arguments.length)&nbsp;<span class="keyword" style="font-weight: bold; color: navy;">return</span>&nbsp;size;<br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">094:</span>&nbsp;&nbsp;&nbsp;&nbsp;size&nbsp;=&nbsp;_size;<br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">095:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" style="font-weight: bold; color: navy;">return</span>&nbsp;<span class="keyword" style="font-weight: bold; color: navy;">this</span>;<br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">096:</span>&nbsp;&nbsp;};<br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">097:</span><br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">098:</span>&nbsp;&nbsp;<span class="comment" style="color: #777;">//Create&nbsp;a&nbsp;drawRoutes&nbsp;method&nbsp;that&nbsp;can&nbsp;be&nbsp;invoked&nbsp;to&nbsp;create&nbsp;routes&nbsp;for&nbsp;each&nbsp;city.</span><br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">099:</span>&nbsp;&nbsp;exports.drawRoutes&nbsp;=&nbsp;<span class="keyword" style="font-weight: bold; color: navy;">function</span>(_data)&nbsp;{<br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">100:</span>&nbsp;&nbsp;&nbsp;&nbsp;svg.append(<span class="string" style="color: #050;">'path'</span>)<br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">101:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.attr(<span class="string" style="color: #050;">'class'</span>,&nbsp;<span class="string" style="color: #050;">'route'</span>)<br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">102:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.datum(topojson.object(_data,&nbsp;_data.objects.routes))<br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">103:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.attr(<span class="string" style="color: #050;">'d'</span>,&nbsp;<span class="keyword" style="font-weight: bold; color: navy;">function</span>(d,&nbsp;i)&nbsp;{<br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">104:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" style="font-weight: bold; color: navy;">return</span>&nbsp;path(d);<br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">105:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;});<br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">106:</span><br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">107:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" style="color: #777;">//Dispatch&nbsp;our&nbsp;routesEnd&nbsp;event&nbsp;so&nbsp;we&nbsp;know&nbsp;with&nbsp;the&nbsp;routes&nbsp;visualization&nbsp;is&nbsp;complete.</span><br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">108:</span>&nbsp;&nbsp;&nbsp;&nbsp;dispatch.routesEnd();<br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">109:</span>&nbsp;&nbsp;};<br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">110:</span><br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">111:</span>&nbsp;&nbsp;exports.drawStops&nbsp;=&nbsp;<span class="keyword" style="font-weight: bold; color: navy;">function</span>(_data)&nbsp;{<br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">112:</span>&nbsp;&nbsp;&nbsp;&nbsp;svg.selectAll(<span class="string" style="color: #050;">'.stop'</span>)<br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">113:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.data(&nbsp;_data.features)<br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">114:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.enter().append(<span class="string" style="color: #050;">'circle'</span>)<br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">115:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.attr(<span class="string" style="color: #050;">'cx'</span>,&nbsp;<span class="function"><span class="keyword" style="font-weight: bold; color: navy;">function</span>&nbsp;<span class="params">(d)</span>&nbsp;{</span><span class="keyword" style="font-weight: bold; color: navy;">return</span>&nbsp;projection(d.geometry.coordinates)[<span class="number" style="color: #800;">0</span>];})<br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">116:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.attr(<span class="string" style="color: #050;">'cy'</span>,&nbsp;<span class="function"><span class="keyword" style="font-weight: bold; color: navy;">function</span>&nbsp;<span class="params">(d)</span>&nbsp;{</span><span class="keyword" style="font-weight: bold; color: navy;">return</span>&nbsp;projection(d.geometry.coordinates)[<span class="number" style="color: #800;">1</span>];})<br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">117:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.attr(<span class="string" style="color: #050;">'r'</span>,&nbsp;<span class="number" style="color: #800;">2</span>)<br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">118:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.attr(<span class="string" style="color: #050;">'class'</span>,&nbsp;<span class="string" style="color: #050;">'stop'</span>)<br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">119:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.on(<span class="string" style="color: #050;">'mouseover'</span>,&nbsp;dispatch.hover);<br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">120:</span><br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">121:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" style="color: #777;">//Dispatch&nbsp;our&nbsp;stopsEnd&nbsp;event&nbsp;so&nbsp;we&nbsp;know&nbsp;with&nbsp;the&nbsp;stops&nbsp;visualization&nbsp;is&nbsp;complete.</span><br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">122:</span>&nbsp;&nbsp;&nbsp;&nbsp;dispatch.stopsEnd();<br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">123:</span>&nbsp;&nbsp;};<br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">124:</span><br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">125:</span>&nbsp;&nbsp;<span class="comment" style="color: #777;">//Bind&nbsp;our&nbsp;custom&nbsp;events&nbsp;to&nbsp;the&nbsp;'on'&nbsp;method&nbsp;of&nbsp;our&nbsp;function.</span><br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">126:</span>&nbsp;&nbsp;d3.rebind(exports,&nbsp;dispatch,&nbsp;<span class="string" style="color: #050;">'on'</span>);<br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">127:</span><br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">128:</span>&nbsp;&nbsp;<span class="keyword" style="font-weight: bold; color: navy;">return</span>&nbsp;exports;<br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">129:</span>};<br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">130:</span><br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">131:</span><span class="comment" style="color: #777;">//Define&nbsp;our&nbsp;width&nbsp;and&nbsp;height&nbsp;for&nbsp;our&nbsp;visualizations.</span><br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">132:</span><span class="keyword" style="font-weight: bold; color: navy;">var</span>&nbsp;width&nbsp;=&nbsp;<span class="number" style="color: #800;">570</span>,<br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">133:</span>&nbsp;&nbsp;&nbsp;&nbsp;height&nbsp;=&nbsp;<span class="number" style="color: #800;">500</span>;<br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">134:</span><br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">135:</span><span class="comment" style="color: #777;">//Instantiate&nbsp;our&nbsp;data&nbsp;manager&nbsp;module&nbsp;for&nbsp;each&nbsp;Zurich.</span><br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">136:</span><span class="keyword" style="font-weight: bold; color: navy;">var</span>&nbsp;zurichDataManager&nbsp;=&nbsp;d3Edge.dataManager();<br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">137:</span><br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">138:</span><span class="comment" style="color: #777;">//Instantiate&nbsp;our&nbsp;map&nbsp;module&nbsp;for&nbsp;Zurich.</span><br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">139:</span><span class="keyword" style="font-weight: bold; color: navy;">var</span>&nbsp;zurichMap&nbsp;=&nbsp;d3Edge.map()<br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">140:</span>&nbsp;&nbsp;.center([<span class="number" style="color: #800;">8.5390</span>,&nbsp;<span class="number" style="color: #800;">47.3687</span>])<br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">141:</span>&nbsp;&nbsp;.scale(<span class="number" style="color: #800;">900000</span>)<br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">142:</span>&nbsp;&nbsp;.size([width,&nbsp;height]);<br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">143:</span><br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">144:</span><span class="comment" style="color: #777;">//Bind&nbsp;our&nbsp;modules&nbsp;to&nbsp;the&nbsp;DOM.</span><br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">145:</span>d3.select(<span class="string" style="color: #050;">'#zurich_map'</span>)<br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">146:</span>&nbsp;&nbsp;.append(<span class="string" style="color: #050;">'svg'</span>)<br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">147:</span>&nbsp;&nbsp;&nbsp;&nbsp;.attr(<span class="string" style="color: #050;">'width'</span>,&nbsp;width)<br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">148:</span>&nbsp;&nbsp;&nbsp;&nbsp;.attr(<span class="string" style="color: #050;">'height'</span>,&nbsp;height)<br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">149:</span>&nbsp;&nbsp;&nbsp;&nbsp;.call(zurichMap);<br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">150:</span><br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">151:</span><span class="comment" style="color: #777;">//Load&nbsp;the&nbsp;routes&nbsp;data&nbsp;and&nbsp;pass&nbsp;our&nbsp;drawRoutes&nbsp;method&nbsp;as&nbsp;the&nbsp;callback&nbsp;to&nbsp;be&nbsp;executed&nbsp;once&nbsp;the&nbsp;data&nbsp;loads.</span><br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">152:</span>zurichDataManager.loadGeoJson(<span class="string" style="color: #050;">'../../../data/zurich/routes_topo.json'</span>,&nbsp;zurichMap.drawRoutes);<br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">153:</span><br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">154:</span><span class="comment" style="color: #777;">//After&nbsp;the&nbsp;routes&nbsp;have&nbsp;been&nbsp;drawn,&nbsp;draw&nbsp;the&nbsp;stops.</span><br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">155:</span>zurichMap.on(<span class="string" style="color: #050;">'routesEnd'</span>,&nbsp;<span class="function"><span class="keyword" style="font-weight: bold; color: navy;">function</span>&nbsp;<span class="params">()</span>&nbsp;{</span><br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">156:</span>&nbsp;&nbsp;<span class="comment" style="color: #777;">//Load&nbsp;the&nbsp;stops&nbsp;data&nbsp;and&nbsp;pass&nbsp;our&nbsp;drawStops&nbsp;method&nbsp;as&nbsp;the&nbsp;callback&nbsp;to&nbsp;be&nbsp;executed&nbsp;once&nbsp;the&nbsp;data&nbsp;loads.</span><br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">157:</span>&nbsp;&nbsp;zurichDataManager.loadGeoJson(<span class="string" style="color: #050;">'../../../data/zurich/stops_geo.json'</span>,&nbsp;zurichMap.drawStops);<br /><span class="linenumbering" style="color: #ccc; padding-right: 0.5em;">158:</span>});</code></pre>
